<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>세계지도 학습</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; overflow: hidden; }
        .container { width: 100vw; height: 100vh; position: relative; display: flex; flex-direction: column; }
        .header { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); padding: 15px 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; z-index: 10; }
        .title { font-size: 1.5rem; font-weight: 700; color: #2c3e50; }
        .controls { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        .control-group { display: flex; align-items: center; gap: 8px; background: rgba(255, 255, 255, 0.7); padding: 8px 12px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        .toggle { position: relative; display: inline-block; width: 50px; height: 24px; }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #4CAF50; }
        input:checked + .slider:before { transform: translateX(26px); }
        .size-slider { width: 120px; }
        .btn { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; font-weight: 500; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }
        .map-wrapper { flex: 1; overflow: auto; }
        .map-container { position: relative; width: 100%; height: 100%; background: linear-gradient(to bottom, #87CEEB 0%, #98D4EA 50%, #87CEEB 100%); }
        #worldMap { cursor: grab; display: block; }
        #worldMap:active { cursor: grabbing; }
        .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 255, 255, 0.9); padding: 20px 40px; border-radius: 10px; font-size: 1.2rem; font-weight: 500; color: #2c3e50; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); }
        .country { stroke-width: 0.5; stroke: #333; }
        .country:hover { stroke-width: 1.5; stroke: #c0392b; filter: brightness(1.1); }
        .grid-line { fill: none; stroke: #666; stroke-width: 0.2; opacity: 0.5; pointer-events: none; }
        .country-label {
            font-family: 'Noto Sans KR', sans-serif;
            text-anchor: middle;
            fill: #2c3e50;
            font-weight: 600;
            pointer-events: none;
            paint-order: stroke;
            stroke: white;
            /* [수정] stroke-width는 JS에서 동적으로 제어 */
            stroke-linejoin: round;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">🌍 세계지도 학습</div>
            <div class="controls">
                <div class="control-group">
                    <label>나라 이름</label>
                    <label class="toggle">
                        <input type="checkbox" id="showLabels" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-group">
                    <label>글자 크기</label>
                    <input type="range" id="fontSize" class="size-slider" min="8" max="24" value="9">
                    <span id="fontSizeValue">9px</span>
                </div>
                <div class="control-group">
                    <label>지도 크기</label>
                    <input type="range" id="mapSize" class="size-slider" min="1200" max="60000" value="1200" step="100">
                    <span id="mapSizeValue">1200px</span>
                </div>
                <button class="btn" onclick="downloadPNG()">PNG 다운로드</button>
                <button class="btn" onclick="downloadSVG()">SVG 다운로드</button>
            </div>
        </div>
        <div class="map-wrapper">
            <div class="map-container">
                <div class="loading" id="loadingIndicator">지도 데이터를 불러오는 중...</div>
                <svg id="worldMap"></svg>
            </div>
        </div>
    </div>

    <script>
        let currentScale = 1, currentX = 0, currentY = 0;
        let isDragging = false, dragStart = { x: 0, y: 0 };
        let worldData = null;
        let mapWidth = 1200, mapHeight = 600;

        const pastelColors = [ '#FFB3BA', '#FFDFBA', '#FFFFBA', '#BAFFC9', '#BAE1FF', '#E0BBE4', '#FFC3A0', '#B5EAD7', '#C7CEEA', '#FFDAB9' ];
        // [수정] 240여개 국가 및 지역 한글 이름 데이터로 교체
        const countryNames = {

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¸ê³„ì§€ë„ í•™ìŠµ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; overflow: hidden; }
        .container { width: 100vw; height: 100vh; position: relative; display: flex; flex-direction: column; }
        .header { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); padding: 15px 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; z-index: 10; }
        .title { font-size: 1.5rem; font-weight: 700; color: #2c3e50; }
        .controls { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        .control-group { display: flex; align-items: center; gap: 8px; background: rgba(255, 255, 255, 0.7); padding: 8px 12px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        .toggle { position: relative; display: inline-block; width: 50px; height: 24px; }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #4CAF50; }
        input:checked + .slider:before { transform: translateX(26px); }
        .size-slider { width: 120px; }
        .btn { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; font-weight: 500; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }
        .map-wrapper { flex: 1; overflow: auto; position: relative; }
        .map-container { position: relative; background: linear-gradient(to bottom, #87CEEB 0%, #98D4EA 50%, #87CEEB 100%); }
        #worldMap { cursor: grab; display: block; }
        #worldMap:active { cursor: grabbing; }
        .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 255, 255, 0.9); padding: 20px 40px; border-radius: 10px; font-size: 1.2rem; font-weight: 500; color: #2c3e50; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); z-index: 20; }
        .country { stroke-width: 0.5; stroke: #333; transition: all 0.1s ease-in-out; }
        .country-hover { stroke-width: 1.5; stroke: #c0392b; filter: brightness(1.1); }
        .grid-line { fill: none; stroke: #666; stroke-width: 0.2; opacity: 0.5; pointer-events: none; }
        .country-label { font-family: 'Noto Sans KR', sans-serif; text-anchor: middle; fill: #2c3e50; font-weight: 600; pointer-events: none; paint-order: stroke; stroke: white; stroke-linejoin: round; transition: all 0.1s ease-in-out; }
        .label-hover { fill: #c0392b; }
        .zoom-control { display: flex; align-items: center; gap: 8px; }
        .zoom-btn { width: 32px; height: 32px; border-radius: 50%; border: none; background: linear-gradient(45deg, #667eea, #764ba2); color: #fff; font-size: 1.2rem; line-height: 1; cursor: pointer; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15); transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .zoom-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        /* [ì¶”ê°€] êµ­ê°€ ëª©ë¡ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .country-list-panel { position: absolute; top: 0; right: 0; width: calc(100% / 6); height: 100%; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(5px); transform: translateX(0); transition: transform 0.3s ease-in-out; overflow-y: auto; z-index: 15; border-left: 1px solid rgba(0,0,0,0.1); }
        .country-list-panel.hidden { transform: translateX(100%); }
        .country-list-panel h3 { font-size: 1rem; padding: 15px; background: rgba(0,0,0,0.05); text-align: center; }
        .country-list-panel ul { list-style: none; padding: 10px; }
        .country-list-panel li { padding: 8px 15px; font-size: 0.9rem; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">ğŸŒ ì„¸ê³„ì§€ë„ í•™ìŠµ</div>
            <div class="controls">
                <div class="control-group"><label>ë‚˜ë¼ ì´ë¦„</label><label class="toggle"><input type="checkbox" id="showLabels" checked><span class="slider"></span></label></div>
                <div class="control-group"><label>ê¸€ì í¬ê¸°</label><input type="range" id="fontSize" class="size-slider" min="8" max="48" value="9"><span id="fontSizeValue">9px</span></div>
                <div class="control-group">
                    <label>ì¤Œ</label>
                    <div class="zoom-control">
                        <button type="button" class="zoom-btn" id="zoomOutBtn" aria-label="ì¶•ì†Œ">âˆ’</button>
                        <span id="zoomValue">100%</span>
                        <button type="button" class="zoom-btn" id="zoomInBtn" aria-label="í™•ëŒ€">+</button>
                    </div>
                </div>
                <button class="btn" id="toggleListBtn">ëª©ë¡</button>
                <button class="btn" onclick="downloadPNG()">PNG ë‹¤ìš´ë¡œë“œ</button>
                <button class="btn" onclick="downloadSVG()">SVG ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>
        <div class="map-wrapper">
            <div class="map-container" id="mapContainer">
                <div class="loading" id="loadingIndicator">ì§€ë„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                <svg id="worldMap"></svg>
            </div>
            <div class="country-list-panel" id="countryListPanel">
                <h3>í˜„ì¬ ë³´ì´ëŠ” êµ­ê°€</h3>
                <ul id="countryList"></ul>
            </div>
        </div>
    </div>

    <script>
        let currentScale = 1, currentX = 0, currentY = 0;
        let isDragging = false, dragStart = { x: 0, y: 0 }, panStart = { x: 0, y: 0 };
        let worldData = null;
        const BASE_MAP_WIDTH = 3840;
        const BASE_MAP_HEIGHT = 1920;
        let mapWidth = BASE_MAP_WIDTH, mapHeight = BASE_MAP_HEIGHT;
        const MAX_SCALE = 5;
        const MIN_SCALE = 0.01;

        const pastelColors = [ '#FFB3BA', '#FFDFBA', '#FFFFBA', '#BAFFC9', '#BAE1FF', '#E0BBE4', '#FFC3A0', '#B5EAD7', '#C7CEEA', '#FFDAB9' ];
        const countryNames = {
            "AF": "ì•„í”„ê°€ë‹ˆìŠ¤íƒ„",
            "AO": "ì•™ê³¨ë¼",
            "AL": "ì•Œë°”ë‹ˆì•„",
            "AE": "ì•„ëì—ë¯¸ë¦¬íŠ¸",
            "AR": "ì•„ë¥´í—¨í‹°ë‚˜",
            "AM": "ì•„ë¥´ë©”ë‹ˆì•„",
            "TF": "í”„ë‘ìŠ¤ë ¹ ë‚¨ë°© ë° ë‚¨ê·¹",
            "AU": "í˜¸ì£¼",
            "AT": "ì˜¤ìŠ¤íŠ¸ë¦¬ì•„",
            "AZ": "ì•„ì œë¥´ë°”ì´ì”",
            "BI": "ë¶€ë£¬ë””",
            "BE": "ë²¨ê¸°ì—",
            "BJ": "ë² ëƒ‰",
            "BF": "ë¶€ë¥´í‚¤ë‚˜íŒŒì†Œ",
            "BD": "ë°©ê¸€ë¼ë°ì‹œ",
            "BG": "ë¶ˆê°€ë¦¬ì•„",
            "BA": "ë³´ìŠ¤ë‹ˆì•„ í—¤ë¥´ì²´ê³ ë¹„ë‚˜",
            "BY": "ë²¨ë¼ë£¨ìŠ¤",
            "BZ": "ë²¨ë¦¬ì¦ˆ",
            "BM": "ë²„ë®¤ë‹¤",
            "BO": "ë³¼ë¦¬ë¹„ì•„",
            "BR": "ë¸Œë¼ì§ˆ",
            "BN": "ë¸Œë£¨ë‚˜ì´",
            "BT": "ë¶€íƒ„",
            "BW": "ë³´ì¸ ì™€ë‚˜",
            "CF": "ì¤‘ì•™ì•„í”„ë¦¬ì¹´ ê³µí™”êµ­",
            "CA": "ìºë‚˜ë‹¤",
            "CH": "ìŠ¤ìœ„ìŠ¤",
            "CL": "ì¹ ë ˆ",
            "CN": "ì¤‘êµ­",
            "CI": "ì½”íŠ¸ë””ë¶€ì•„ë¥´",
            "CM": "ì¹´ë©”ë£¬",
            "CD": "ì½©ê³  ë¯¼ì£¼ ê³µí™”êµ­",
            "CG": "ì½©ê³  ê³µí™”êµ­",
            "CO": "ì½œë¡¬ë¹„ì•„",
            "CR": "ì½”ìŠ¤íƒ€ë¦¬ì¹´",
            "CU": "ì¿ ë°”",
            "CY": "í‚¤í”„ë¡œìŠ¤",
            "CZ": "ì²´ì½”",
            "DE": "ë…ì¼",
            "DJ": "ì§€ë¶€í‹°",
            "DK": "ë´ë§ˆí¬",
            "DO": "ë„ë¯¸ë‹ˆì¹´ ê³µí™”êµ­",
            "DZ": "ì•Œì œë¦¬",
            "EC": "ì—ì½°ë„ë¥´",
            "EG": "ì´ì§‘íŠ¸",
            "ER": "ì—ë¦¬íŠ¸ë ˆì•„",
            "ES": "ìŠ¤í˜ì¸",
            "EE": "ì—ìŠ¤í† ë‹ˆì•„",
            "ET": "ì—í‹°ì˜¤í”¼ì•„",
            "FI": "í•€ë€ë“œ",
            "FJ": "í”¼ì§€",
            "GA": "ê°€ë´‰",
            "GB": "ì˜êµ­",
            "GE": "ì¡°ì§€ì•„",
            "GH": "ê°€ë‚˜",
            "GN": "ê¸°ë‹ˆ",
            "GM": "ê°ë¹„ì•„",
            "GW": "ê¸°ë‹ˆë¹„ì‚¬ìš°",
            "GQ": "ì ë„ ê¸°ë‹ˆ",
            "GR": "ê·¸ë¦¬ìŠ¤",
            "GL": "ê·¸ë¦°ë€ë“œ",
            "GT": "ê³¼í…Œë§ë¼",
            "GY": "ê°€ì´ì•„ë‚˜",
            "HN": "ì˜¨ë‘ë¼ìŠ¤",
            "HR": "í¬ë¡œì•„í‹°ì•„",
            "HT": "ì•„ì´í‹°",
            "HU": "í—ê°€ë¦¬",
            "ID": "ì¸ë„ë„¤ì‹œì•„",
            "IN": "ì¸ë„",
            "IE": "ì•„ì¼ëœë“œ",
            "IR": "ì´ë€",
            "IQ": "ì´ë¼í¬",
            "IS": "ì•„ì´ìŠ¬ë€ë“œ",
            "IL": "ì´ìŠ¤ë¼ì—˜",
            "IT": "ì´íƒˆë¦¬ì•„",
            "JM": "ìë©”ì´ì¹´",
            "JO": "ìš”ë¥´ë‹¨",
            "JP": "ì¼ë³¸",
            "KZ": "ì¹´ìíìŠ¤íƒ„",
            "KE": "ì¼€ëƒ",
            "KG": "í‚¤ë¥´ê¸°ìŠ¤ìŠ¤íƒ„",
            "KH": "ìº„ë³´ë””ì•„",
            "KR": "ëŒ€í•œë¯¼êµ­",
            "XK": "ì½”ì†Œë³´",
            "KW": "ì¿ ì›¨ì´íŠ¸",
            "LA": "ë¼ì˜¤ìŠ¤",
            "LB": "ë ˆë°”ë…¼",
            "LR": "ë¼ì´ë² ë¦¬ì•„",
            "LY": "ë¦¬ë¹„ì•„",
            "LK": "ìŠ¤ë¦¬ë‘ì¹´",
            "LS": "ë ˆì†Œí† ",
            "LT": "ë¦¬íˆ¬ì•„ë‹ˆì•„",
            "LU": "ë£©ì…ˆë¶€ë¥´í¬",
            "LV": "ë¼íŠ¸ë¹„ì•„",
            "MA": "ëª¨ë¡œì½”",
            "MD": "ëª°ë„ë°”",
            "MG": "ë§ˆë‹¤ê°€ìŠ¤ì¹´ë¥´",
            "MX": "ë©•ì‹œì½”",
            "MK": "ë¶ë§ˆì¼€ë„ë‹ˆì•„",
            "ML": "ë§ë¦¬",
            "MM": "ë¯¸ì–€ë§ˆ",
            "ME": "ëª¬í…Œë„¤ê·¸ë¡œ",
            "MN": "ëª½ê³¨",
            "MZ": "ëª¨ì ë¹„í¬",
            "MR": "ëª¨ë¦¬íƒ€ë‹ˆ",
            "MW": "ë§ë¼ìœ„",
            "MY": "ë§ë ˆì´ì‹œì•„",
            "NA": "ë‚˜ë¯¸ë¹„ì•„",
            "NC": "ëˆ„ë²¨ì¹¼ë ˆë„ë‹ˆ",
            "NE": "ë‹ˆì œë¥´",
            "NG": "ë‚˜ì´ì§€ë¦¬ì•„",
            "NI": "ë‹ˆì¹´ë¼ê³¼",
            "NL": "ë„¤ëœë€ë“œ",
            "NO": "ë…¸ë¥´ì›¨ì´",
            "NP": "ë„¤íŒ”",
            "NZ": "ë‰´ì§ˆëœë“œ",
            "OM": "ì˜¤ë§Œ",
            "PK": "íŒŒí‚¤ìŠ¤íƒ„",
            "PA": "íŒŒë‚˜ë§ˆ",
            "PE": "í˜ë£¨",
            "PH": "í•„ë¦¬í•€",
            "PG": "íŒŒí‘¸ì•„ë‰´ê¸°ë‹ˆ",
            "PL": "í´ë€ë“œ",
            "PR": "í‘¸ì—ë¥´í† ë¦¬ì½”",
            "KP": "ì¡°ì„ ë¯¼ì£¼ì£¼ì˜ì¸ë¯¼ê³µí™”êµ­",
            "PT": "í¬ë¥´íˆ¬ê°ˆ",
            "PY": "íŒŒë¼ê³¼ì´",
            "QA": "ì¹´íƒ€ë¥´",
            "RO": "ë£¨ë§ˆë‹ˆì•„",
            "RU": "ëŸ¬ì‹œì•„",
            "RW": "ë¥´ì™„ë‹¤",
            "EH": "ì„œì‚¬í•˜ë¼",
            "SA": "ì‚¬ìš°ë””ì•„ë¼ë¹„ì•„",
            "SD": "ìˆ˜ë‹¨",
            "SS": "ë‚¨ìˆ˜ë‹¨",
            "SN": "ì„¸ë„¤ê°ˆ",
            "SB": "ì†”ë¡œëª¬ ì œë„",
            "SL": "ì‹œì—ë¼ë¦¬ì˜¨",
            "SV": "ì—˜ì‚´ë°”ë„ë¥´",
            "SO": "ì†Œë§ë¦¬ì•„",
            "RS": "ì„¸ë¥´ë¹„ì•„",
            "SR": "ìˆ˜ë¦¬ë‚¨",
            "SK": "ìŠ¬ë¡œë°”í‚¤ì•„",
            "SI": "ìŠ¬ë¡œë² ë‹ˆì•„",
            "SE": "ìŠ¤ì›¨ë´",
            "SZ": "ì—ìŠ¤ì™€í‹°ë‹ˆ",
            "SY": "ì‹œë¦¬ì•„",
            "TD": "ì°¨ë“œ",
            "TG": "í† ê³ ",
            "TH": "íƒœêµ­",
            "TJ": "íƒ€ì§€í‚¤ìŠ¤íƒ„",
            "TM": "íˆ¬ë¥´í¬ë©”ë‹ˆìŠ¤íƒ„",
            "TL": "ë™í‹°ëª¨ë¥´",
            "TT": "íŠ¸ë¦¬ë‹ˆë‹¤ë“œ í† ë°”ê³ ",
            "TN": "íŠ€ë‹ˆì§€",
            "TR": "íŠ€ë¥´í‚¤ì˜ˆ",
            "TW": "ëŒ€ë§Œ",
            "TZ": "íƒ„ìë‹ˆì•„",
            "UG": "ìš°ê°„ë‹¤",
            "UA": "ìš°í¬ë¼ì´ë‚˜",
            "UY": "ìš°ë£¨ê³¼ì´",
            "US": "ë¯¸êµ­",
            "UZ": "ìš°ì¦ˆë² í‚¤ìŠ¤íƒ„",
            "VE": "ë² ë„¤ìˆ˜ì—˜ë¼",
            "VN": "ë² íŠ¸ë‚¨",
            "VU": "ë°”ëˆ„ì•„íˆ¬",
            "PS": "íŒ”ë ˆìŠ¤íƒ€ì¸",
            "YE": "ì˜ˆë©˜",
            "ZA": "ë‚¨ì•„í”„ë¦¬ì¹´ ê³µí™”êµ­",
            "ZM": "ì ë¹„ì•„",
            "ZW": "ì§ë°”ë¸Œì›¨",
            "AW": "ì•„ë£¨ë°”",
            "AI": "ì•µê·ˆë¼",
            "AS": "ì•„ë©”ë¦¬ì¹¸ì‚¬ëª¨ì•„",
            "AG": "ì•¤í‹°ê°€ ë°”ë¶€ë‹¤",
            "BH": "ë°”ë ˆì¸",
            "BB": "ë°”ë² ì´ë„ìŠ¤",
            "BL": "ìƒë°”ë¥´í…”ë ˆë¯¸",
            "BS": "ë°”í•˜ë§ˆ",
            "IO": "ì˜êµ­ë ¹ ì¸ë„ì–‘ ì§€ì—­",
            "KY": "ì¼€ì´ë§¨ ì œë„",
            "KM": "ì½”ëª¨ë¡œ",
            "CV": "ì¹´ë³´ë² ë¥´ë°",
            "CK": "ì¿¡ ì œë„",
            "CW": "í€´ë¼ì†Œ",
            "DM": "ë„ë¯¸ë‹ˆì¹´ ì—°ë°©",
            "FK": "í¬í´ëœë“œ ì œë„",
            "FO": "í˜ë¡œ ì œë„",
            "FM": "ë¯¸í¬ë¡œë„¤ì‹œì•„ ì—°ë°©",
            "GD": "ê·¸ë ˆë‚˜ë‹¤",
            "GU": "ê´Œ",
            "GG": "ê±´ì§€",
            "HK": "í™ì½©",
            "IM": "ë§¨ì„¬",
            "JE": "ì €ì§€",
            "KI": "í‚¤ë¦¬ë°”ì‹œ",
            "KN": "ì„¸ì¸íŠ¸í‚¤ì¸  ë„¤ë¹„ìŠ¤",
            "LC": "ì„¸ì¸íŠ¸ë£¨ì‹œì•„",
            "LI": "ë¦¬íˆí…ìŠˆíƒ€ì¸",
            "MO": "ë§ˆì¹´ì˜¤",
            "MF": "ìƒë§ˆë¥´íƒ±",
            "MV": "ëª°ë””ë¸Œ",
            "MS": "ëª¬íŠ¸ì„¸ë«",
            "MU": "ëª¨ë¦¬ì…”ìŠ¤",
            "MP": "ë¶ë§ˆë¦¬ì•„ë‚˜ ì œë„",
            "MT": "ëª°íƒ€",
            "NU": "ë‹ˆìš°ì—",
            "NR": "ë‚˜ìš°ë£¨",
            "PN": "í•ì¼€ì–¸ ì œë„",
            "PW": "íŒ”ë¼ìš°",
            "SM": "ì‚°ë§ˆë¦¬ë…¸",
            "ST": "ìƒíˆ¬ë©” í”„ë¦°ì‹œí˜",
            "SC": "ì„¸ì´ì…¸",
            "SG": "ì‹±ê°€í¬ë¥´",
            "SH": "ì„¸ì¸íŠ¸í—¬ë ˆë‚˜",
            "SX": "ì‹ íŠ¸ë§ˆë¥´í„´",
            "TC": "í„°í¬ìŠ¤ ì¼€ì´ì»¤ìŠ¤ ì œë„",
            "TO": "í†µê°€",
            "TV": "íˆ¬ë°œë£¨",
            "VC": "ì„¸ì¸íŠ¸ë¹ˆì„¼íŠ¸ ê·¸ë ˆë‚˜ë”˜",
            "VG": "ì˜êµ­ë ¹ ë²„ì§„ì•„ì¼ëœë“œ",
            "VI": "ë¯¸êµ­ë ¹ ë²„ì§„ì•„ì¼ëœë“œ",
            "WS": "ì‚¬ëª¨ì•„",
            "GS": "ì‚¬ìš°ìŠ¤ì¡°ì§€ì•„ ì‚¬ìš°ìŠ¤ìƒŒë“œìœ„ì¹˜ ì œë„"
        };


        const mercatorProjection = (lon, lat) => [(lon + 180) * (mapWidth / 360), (mapHeight / 2) - (mapWidth / (2 * Math.PI)) * Math.log(Math.tan(Math.PI / 4 + lat * Math.PI / 360))];
        const geoJsonToSvgPath = (coordinates, type) => {
            let path = '';
            if (type === 'Polygon') path = coordinates.map(ring => 'M' + ring.map(p => mercatorProjection(p[0], p[1]).join(',')).join('L') + 'Z').join('');
            else if (type === 'MultiPolygon') path = coordinates.map(polygon => polygon.map(ring => 'M' + ring.map(p => mercatorProjection(p[0], p[1]).join(',')).join('L') + 'Z').join('')).join('');
            return path;
        };
        const getPolygonArea = coords => {
            let area = 0;
            for (let i = 0; i < coords.length; i++) {
                const [x1, y1] = mercatorProjection(coords[i][0], coords[i][1]);
                const [x2, y2] = mercatorProjection(coords[(i + 1) % coords.length][0], coords[(i + 1) % coords.length][1]);
                area += x1 * y2 - x2 * y1;
            }
            return Math.abs(area / 2);
        };

        async function loadWorldData() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            try {
                const response = await fetch('https://tb.tues.myds.me/ne_50m_admin_0_countries.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                worldData = await response.json();
                worldData.features.forEach(f => {
                    if (!f.geometry) return;
                    const largestPart = f.geometry.type === 'Polygon' ? f.geometry.coordinates[0] : f.geometry.coordinates.reduce((a, b) => a.flat().length > b.flat().length ? a : b, [])[0];
                    f.properties.calculatedArea = largestPart ? getPolygonArea(largestPart) : 0;
                });
                worldData.features.sort((a, b) => b.properties.calculatedArea - a.properties.calculatedArea);
                loadingIndicator.style.display = 'none';
                initMap();
            } catch (error) { loadingIndicator.textContent = 'ì§€ë„ ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'; }
        }
        
        function initMap() {
            const svg = document.getElementById('worldMap');
            const mapContainer = document.getElementById('mapContainer');
            svg.setAttribute('width', mapWidth); svg.setAttribute('height', mapHeight);
            svg.setAttribute('viewBox', `0 0 ${mapWidth} ${mapHeight}`);
            mapContainer.style.width = mapWidth + 'px'; mapContainer.style.height = mapHeight + 'px';
            svg.innerHTML = `<g id="gridLines"></g><g id="countries"></g><g id="countryLabels"></g>`;
            drawMap();
            updateDynamicSizes(); // [ìˆ˜ì •] ìµœì´ˆ ë¡œë“œ ì‹œì—ë§Œ ê¸€ì í¬ê¸° ìë™ ì¡°ì ˆ
            updateCountryList(); // [ì¶”ê°€] ì´ˆê¸° êµ­ê°€ ëª©ë¡ ì—…ë°ì´íŠ¸
            updateZoomDisplay();
        }

        function drawMap() {
            if (!worldData) return;
            const countryGroup = document.getElementById('countries');
            const labelGroup = document.getElementById('countryLabels');

            worldData.features.forEach((feature, index) => {
                const { properties, geometry } = feature;
                if (!geometry || properties.ISO_A2 === '-99') return;
                const countryCode = properties.ISO_A2;
                const countryName = countryNames[countryCode] || properties.ADMIN;

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', geoJsonToSvgPath(geometry.coordinates, geometry.type));
                path.setAttribute('class', 'country');
                path.setAttribute('fill', pastelColors[index % pastelColors.length]);
                path.dataset.countryCode = countryCode;
                countryGroup.appendChild(path);

                if (countryName) {
                    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    label.setAttribute('class', 'country-label'); label.textContent = countryName; label.dataset.countryCode = countryCode;
                    labelGroup.appendChild(label);

                    const largestPolygon = geometry.type === 'Polygon'
                        ? geometry.coordinates
                        : geometry.coordinates.reduce((largest, polygon) => {
                            const largestLength = largest?.[0]?.length || 0;
                            const polygonLength = polygon?.[0]?.length || 0;
                            return polygonLength > largestLength ? polygon : largest;
                        }, geometry.coordinates[0]);
                    const largestPartCoords = largestPolygon[0] || [];
                    const centerLonLat = getPolygonCenter(largestPartCoords);
                    const [cx, cy] = mercatorProjection(centerLonLat[0], centerLonLat[1]);
                    label.setAttribute('x', cx);
                    label.setAttribute('y', cy);
                }
            });

            countryGroup.querySelectorAll('.country').forEach(path => { path.addEventListener('mouseover', handleCountryHover); path.addEventListener('mouseout', handleCountryHover); });
            drawGridLines();
        }
        
        function handleCountryHover(event) {
            const code = event.target.dataset.countryCode; if (!code) return;
            const label = document.querySelector(`.country-label[data-country-code="${code}"]`);
            if (event.type === 'mouseover') { event.target.classList.add('country-hover'); if (label) label.classList.add('label-hover'); } 
            else { event.target.classList.remove('country-hover'); if (label) label.classList.remove('label-hover'); }
        }
        
        const getPolygonCenter = coords => {
            let lonMin = 180, latMin = 90, lonMax = -180, latMax = -90;
            coords.forEach(p => {
                if (p[0] < lonMin) lonMin = p[0]; if (p[1] < latMin) latMin = p[1];
                if (p[0] > lonMax) lonMax = p[0]; if (p[1] > latMax) latMax = p[1];
            });
            return [(lonMin + lonMax) / 2, (latMin + latMax) / 2];
        };

        function drawGridLines() {
            const grid = document.getElementById('gridLines'); grid.innerHTML = '';
            for (let lon = -180; lon <= 180; lon += 30) {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path'); let d = 'M';
                for (let lat = -85; lat <= 85; lat += 5) d += mercatorProjection(lon, lat).join(',') + 'L';
                path.setAttribute('d', d.slice(0, -1)); path.setAttribute('class', 'grid-line'); grid.appendChild(path);
            }
            for (let lat = -60; lat <= 80; lat += 30) {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path'); let d = 'M';
                for (let lon = -180; lon <= 180; lon += 5) d += mercatorProjection(lon, lat).join(',') + 'L';
                path.setAttribute('d', d.slice(0, -1)); path.setAttribute('class', 'grid-line'); grid.appendChild(path);
            }
        }
        
        function updateDynamicSizes() {
            const optimalFontSize = Math.max(8, Math.min(48, Math.round(mapWidth / 183)));
            document.getElementById('fontSize').value = optimalFontSize;
            updateLabelStyles();
        }
        
        function updateLabelStyles() {
            const fontSize = document.getElementById('fontSize').value;
            const strokeWidth = fontSize / 10; // [ìˆ˜ì •] í…Œë‘ë¦¬ ë‘ê»˜ 1/10ë¡œ ë³€ê²½
            document.getElementById('fontSizeValue').textContent = fontSize + 'px';
            document.querySelectorAll('.country-label').forEach(label => {
                label.setAttribute('font-size', fontSize);
                label.setAttribute('stroke-width', strokeWidth);
            });
            const labelGroup = document.getElementById('countryLabels');
            if (labelGroup) labelGroup.style.display = document.getElementById('showLabels').checked ? '' : 'none';
        }

        function updateZoomDisplay() {
            const zoomValue = document.getElementById('zoomValue');
            if (zoomValue) {
                zoomValue.textContent = `${(currentScale * 100).toFixed(0)}%`;
            }
        }

        function updateCountryList() {
            const listUl = document.getElementById('countryList');
            const svgRect = svg.getBoundingClientRect();

            const visibleCountries = new Set();

            document.querySelectorAll('.country-label').forEach(label => {
                const labelRect = label.getBoundingClientRect();
                // ë ˆì´ë¸”ì´ SVG ë·°í¬íŠ¸ ì•ˆì— ë“¤ì–´ì˜¤ëŠ”ì§€ í™•ì¸
                if (labelRect.right > svgRect.left && labelRect.left < svgRect.right &&
                    labelRect.bottom > svgRect.top && labelRect.top < svgRect.bottom) {
                    visibleCountries.add(label.textContent);
                }
            });
            
            listUl.innerHTML = '';
            Array.from(visibleCountries).sort((a, b) => a.localeCompare(b, 'ko')).forEach(name => {
                const li = document.createElement('li');
                li.textContent = name;
                listUl.appendChild(li);
            });
        }

        document.getElementById('showLabels').addEventListener('change', updateLabelStyles);
        document.getElementById('fontSize').addEventListener('input', updateLabelStyles);
        
        document.getElementById('toggleListBtn').addEventListener('click', () => {
            const panel = document.getElementById('countryListPanel');
            panel.classList.toggle('hidden');
            if (!panel.classList.contains('hidden')) {
                updateCountryList(); // ëª©ë¡ì´ ì—´ë¦´ ë•Œ ì—…ë°ì´íŠ¸
            }
        });

        const svg = document.getElementById('worldMap');

        const getViewportCenterPoint = () => {
            const rect = svg.getBoundingClientRect();
            const point = svg.createSVGPoint();
            point.x = rect.width / 2;
            point.y = rect.height / 2;
            const ctm = svg.getScreenCTM();
            return ctm ? point.matrixTransform(ctm.inverse()) : { x: mapWidth / 2, y: mapHeight / 2 };
        };

        document.getElementById('zoomInBtn').addEventListener('click', () => {
            const centerPoint = getViewportCenterPoint();
            applyZoom(currentScale * 1.05, centerPoint);
        });

        document.getElementById('zoomOutBtn').addEventListener('click', () => {
            const centerPoint = getViewportCenterPoint();
            applyZoom(currentScale / 1.05, centerPoint);
        });

        const updateTransform = () => {
            ['gridLines', 'countries', 'countryLabels'].forEach(id => document.getElementById(id)?.setAttribute('transform', `translate(${currentX}, ${currentY}) scale(${currentScale})`));
            updateZoomDisplay();
            requestAnimationFrame(updateCountryList); // [ì¶”ê°€] ë³€í™˜ í›„ êµ­ê°€ ëª©ë¡ ì—…ë°ì´íŠ¸
        };

        const applyZoom = (targetScale, focusPoint) => {
            const focus = focusPoint || { x: mapWidth / 2, y: mapHeight / 2 };
            const clampedScale = Math.min(MAX_SCALE, Math.max(MIN_SCALE, targetScale));
            const scaleRatio = clampedScale / currentScale;
            currentX = focus.x - (focus.x - currentX) * scaleRatio;
            currentY = focus.y - (focus.y - currentY) * scaleRatio;
            currentScale = clampedScale;
            updateTransform();
        };

        svg.addEventListener('wheel', e => {
            e.preventDefault();
            const rect = svg.getBoundingClientRect();
            const point = svg.createSVGPoint();
            point.x = e.clientX - rect.left; point.y = e.clientY - rect.top;

            // í˜„ì¬ SVG ì¢Œí‘œê³„ì—ì„œì˜ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ ê³„ì‚°
            const svgPoint = point.matrixTransform(svg.getScreenCTM().inverse());

            const scaleFactor = e.deltaY > 0 ? 0.9 : 1.1;
            const newScale = currentScale * scaleFactor;
            applyZoom(newScale, svgPoint);
        });

        svg.addEventListener('mousedown', e => { isDragging = true; panStart.x = currentX; panStart.y = currentY; dragStart.x = e.clientX; dragStart.y = e.clientY; svg.style.cursor = 'grabbing'; });
        svg.addEventListener('mousemove', e => { if (isDragging) { const dx = e.clientX - dragStart.x; const dy = e.clientY - dragStart.y; currentX = panStart.x + dx; currentY = panStart.y + dy; updateTransform(); } });
        const endDrag = () => { isDragging = false; svg.style.cursor = 'grab'; updateCountryList(); }; // [ì¶”ê°€] ë“œë˜ê·¸ ì¢…ë£Œ í›„ êµ­ê°€ ëª©ë¡ ì—…ë°ì´íŠ¸
        svg.addEventListener('mouseup', endDrag);
        svg.addEventListener('mouseleave', endDrag);

        const download = (url, filename) => { const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url); };
        function downloadSVG() {
            const svgEl = document.getElementById('worldMap');
            svgEl.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
            const svgData = svgEl.outerHTML;
            const blob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            download(URL.createObjectURL(blob), 'world_map.svg');
        }
        function downloadPNG() {
            const svgEl = document.getElementById('worldMap');
            const canvas = document.createElement('canvas');
            canvas.width = mapWidth * 2; canvas.height = mapHeight * 2;
            const ctx = canvas.getContext('2d');
            const svgData = new XMLSerializer().serializeToString(svgEl);
            const img = new Image();
            img.onload = () => { ctx.drawImage(img, 0, 0, canvas.width, canvas.height); download(canvas.toDataURL('image/png'), 'world_map.png'); };
            img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            mapWidth = BASE_MAP_WIDTH;
            mapHeight = BASE_MAP_HEIGHT;
            loadWorldData();
        });
    </script>
</body>
</html>
